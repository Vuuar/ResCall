(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{297:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/settings",function(){return r(8799)}])},8799:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return u}});var a=r(1527),n=r(959),t=r(8391),i=r.n(t),m=r(2852),o=r(4995),d=r(4545),c=r(4413),l=r(8563);let x=c.Ry().shape({welcome_message:c.Z_().required("Message de bienvenue requis"),confirmation_message:c.Z_().required("Message de confirmation requis"),reminder_message:c.Z_().required("Message de rappel requis"),reminder_time:c.Rx().min(1,"Doit \xeatre au moins 1 heure").max(72,"Doit \xeatre au maximum 72 heures").required("Temps de rappel requis"),appointment_buffer:c.Rx().min(0,"Doit \xeatre au moins 0 minute").max(120,"Doit \xeatre au maximum 120 minutes").required("Tampon entre rendez-vous requis"),voice_enabled:c.O7(),voice_greeting:c.Z_().when("voice_enabled",{is:!0,then:e=>e.required("Message vocal requis lorsque la voix est activ\xe9e")})});function u(e){let{user:s}=e,[r,t]=(0,n.useState)(null),[c,u]=(0,n.useState)(!0),[p,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&f()},[s]);let f=async()=>{u(!0);try{let{data:e,error:r}=await m.O.from("professional_settings").select("*").eq("professional_id",null==s?void 0:s.id).single();if(r&&"PGRST116"!==r.code)throw r;e&&t(e)}catch(e){console.error("Error fetching settings:",e),l.ZP.error("Erreur lors du chargement des param\xe8tres")}finally{u(!1)}},_=async e=>{g(!0);try{if(r){let{error:s}=await m.O.from("professional_settings").update({welcome_message:e.welcome_message,confirmation_message:e.confirmation_message,reminder_message:e.reminder_message,reminder_time:e.reminder_time,voice_enabled:e.voice_enabled,voice_greeting:e.voice_greeting,appointment_buffer:e.appointment_buffer,updated_at:new Date().toISOString()}).eq("id",r.id);if(s)throw s}else{let{error:r}=await m.O.from("professional_settings").insert([{professional_id:null==s?void 0:s.id,welcome_message:e.welcome_message,confirmation_message:e.confirmation_message,reminder_message:e.reminder_message,reminder_time:e.reminder_time,voice_enabled:e.voice_enabled,voice_greeting:e.voice_greeting,appointment_buffer:e.appointment_buffer,calendar_integration:"none",calendar_sync_enabled:!1}]);if(r)throw r}l.ZP.success("Param\xe8tres enregistr\xe9s avec succ\xe8s"),f()}catch(e){console.error("Error saving settings:",e),l.ZP.error("Erreur lors de l'enregistrement des param\xe8tres")}finally{g(!1)}};return s?(0,a.jsxs)(o.Z,{user:s,children:[(0,a.jsx)(i(),{children:(0,a.jsx)("title",{children:"Param\xe8tres | WhatsApp Booking Assistant"})}),(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:(0,a.jsx)("h1",{className:"text-2xl font-semibold text-secondary-900",children:"Param\xe8tres"})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8 mt-6",children:(0,a.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,a.jsx)("div",{className:"px-4 py-5 sm:p-6",children:c?(0,a.jsx)("div",{className:"animate-pulse space-y-6",children:[...Array(6)].map((e,s)=>(0,a.jsx)("div",{className:"h-10 bg-secondary-100 rounded"},s))}):(0,a.jsx)(d.J9,{initialValues:{welcome_message:(null==r?void 0:r.welcome_message)||"Bonjour, je suis l'assistant virtuel de ".concat(s.business_name,". Comment puis-je vous aider aujourd'hui ?"),confirmation_message:(null==r?void 0:r.confirmation_message)||"Votre rendez-vous a \xe9t\xe9 confirm\xe9. Nous vous attendons le {date} \xe0 {time}. \xc0 bient\xf4t !",reminder_message:(null==r?void 0:r.reminder_message)||"Rappel : Vous avez rendez-vous demain \xe0 {time} chez ".concat(s.business_name,"."),reminder_time:(null==r?void 0:r.reminder_time)||24,voice_enabled:(null==r?void 0:r.voice_enabled)||!1,voice_greeting:(null==r?void 0:r.voice_greeting)||"",appointment_buffer:(null==r?void 0:r.appointment_buffer)||15},validationSchema:x,onSubmit:_,children:e=>{let{values:s,errors:r,touched:n,isValid:t}=e;return(0,a.jsxs)(d.l0,{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium leading-6 text-secondary-900 mb-4",children:"Messages automatiques"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"welcome_message",className:"block text-sm font-medium text-secondary-700",children:"Message de bienvenue"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{as:"textarea",id:"welcome_message",name:"welcome_message",rows:3,className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.welcome_message&&n.welcome_message?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"welcome_message",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-secondary-500",children:"Ce message est envoy\xe9 lorsqu'un client vous contacte pour la premi\xe8re fois."})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"confirmation_message",className:"block text-sm font-medium text-secondary-700",children:"Message de confirmation"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{as:"textarea",id:"confirmation_message",name:"confirmation_message",rows:3,className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.confirmation_message&&n.confirmation_message?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"confirmation_message",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-secondary-500",children:["Ce message est envoy\xe9 lorsqu'un rendez-vous est confirm\xe9. Utilisez ","{date}"," et ","{time}"," pour ins\xe9rer la date et l'heure du rendez-vous."]})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"reminder_message",className:"block text-sm font-medium text-secondary-700",children:"Message de rappel"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{as:"textarea",id:"reminder_message",name:"reminder_message",rows:3,className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.reminder_message&&n.reminder_message?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"reminder_message",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-secondary-500",children:["Ce message est envoy\xe9 avant le rendez-vous. Utilisez ","{date}"," et ","{time}"," pour ins\xe9rer la date et l'heure du rendez-vous."]})]}),(0,a.jsxs)("div",{className:"sm:col-span-3",children:[(0,a.jsx)("label",{htmlFor:"reminder_time",className:"block text-sm font-medium text-secondary-700",children:"Temps de rappel (heures)"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{type:"number",id:"reminder_time",name:"reminder_time",min:"1",max:"72",className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.reminder_time&&n.reminder_time?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"reminder_time",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-secondary-500",children:"Combien d'heures avant le rendez-vous le rappel doit-il \xeatre envoy\xe9."})]}),(0,a.jsxs)("div",{className:"sm:col-span-3",children:[(0,a.jsx)("label",{htmlFor:"appointment_buffer",className:"block text-sm font-medium text-secondary-700",children:"Tampon entre rendez-vous (minutes)"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{type:"number",id:"appointment_buffer",name:"appointment_buffer",min:"0",max:"120",className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.appointment_buffer&&n.appointment_buffer?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"appointment_buffer",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-secondary-500",children:"Temps minimum entre deux rendez-vous cons\xe9cutifs."})]})]})]}),(0,a.jsxs)("div",{className:"pt-6 border-t border-secondary-200",children:[(0,a.jsx)("h3",{className:"text-lg font-medium leading-6 text-secondary-900 mb-4",children:"Param\xe8tres vocaux"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,a.jsx)("div",{className:"sm:col-span-6",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex items-center h-5",children:(0,a.jsx)(d.gN,{id:"voice_enabled",name:"voice_enabled",type:"checkbox",className:"focus:ring-primary-500 h-4 w-4 text-primary-600 border-secondary-300 rounded"})}),(0,a.jsxs)("div",{className:"ml-3 text-sm",children:[(0,a.jsx)("label",{htmlFor:"voice_enabled",className:"font-medium text-secondary-700",children:"Activer les r\xe9ponses vocales"}),(0,a.jsx)("p",{className:"text-secondary-500",children:"Permet \xe0 l'assistant de r\xe9pondre aux messages vocaux WhatsApp."})]})]})}),s.voice_enabled&&(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"voice_greeting",className:"block text-sm font-medium text-secondary-700",children:"Message d'accueil vocal"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)(d.gN,{as:"textarea",id:"voice_greeting",name:"voice_greeting",rows:3,className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-secondary-300 rounded-md ".concat(r.voice_greeting&&n.voice_greeting?"border-red-500":"")}),(0,a.jsx)(d.Bc,{name:"voice_greeting",component:"div",className:"text-red-500 text-sm mt-1"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-secondary-500",children:"Ce message sera utilis\xe9 comme introduction lors des r\xe9ponses vocales."})]})]})]}),(0,a.jsx)("div",{className:"pt-6 border-t border-secondary-200",children:(0,a.jsxs)("div",{className:"flex justify-end",children:[(0,a.jsx)("button",{type:"button",className:"bg-white py-2 px-4 border border-secondary-300 rounded-md shadow-sm text-sm font-medium text-secondary-700 hover:bg-secondary-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",onClick:()=>f(),children:"Annuler"}),(0,a.jsx)("button",{type:"submit",disabled:p||!t,className:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):"Enregistrer"})]})})]})}})})})})]})]}):null}}},function(e){e.O(0,[61,989,42,770,995,774,888,179],function(){return e(e.s=297)}),_N_E=e.O()}]);