(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{3819:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return r(5190)}])},2607:function(e,s,r){"use strict";r.d(s,{Z:function(){return i}});var n=r(1527);r(959);var t=r(8391),a=r.n(t);function i(e){let{children:s,title:r="WhatsApp Booking"}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:r}),(0,n.jsx)("meta",{name:"description",content:"WhatsApp Booking Platform"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)("div",{className:"min-h-screen flex flex-col",children:s})]})}},9230:function(e,s,r){"use strict";r.d(s,{a:function(){return a}});var n=r(959),t=r(2852);function a(){let[e,s]=(0,n.useState)(null),[r,a]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async function(){try{a(!0);let{data:{session:e}}=await t.O.auth.getSession();if(null==e?void 0:e.user){let{data:r,error:n}=await t.O.from("professionals").select("*").eq("id",e.user.id).single();n?(console.error("Error fetching professional:",n),s(null)):s(r)}else s(null)}catch(e){console.error("Error getting user:",e),s(null)}finally{a(!1)}})();let{data:e}=t.O.auth.onAuthStateChange(async(e,r)=>{if("SIGNED_IN"===e&&(null==r?void 0:r.user)){let{data:e,error:n}=await t.O.from("professionals").select("*").eq("id",r.user.id).single();n?(console.error("Error fetching professional:",n),s(null)):s(e)}else"SIGNED_OUT"===e&&s(null)});return()=>{e.subscription.unsubscribe()}},[]),{user:e,loading:r}}},5190:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return c}});var n=r(1527),t=r(959),a=r(9230),i=r(2852),o=r(2607),l=r(8563),d=r(7035);function c(){let{user:e,loading:s}=(0,a.a)(),[r,c]=(0,t.useState)(null),[u,m]=(0,t.useState)(!0),[h,x]=(0,t.useState)(!1),[g,f]=(0,t.useState)(""),[b,p]=(0,t.useState)("Ceci est un message de test de WhatsApp Business API."),[v,j]=(0,t.useState)(!1);(0,t.useEffect)(()=>{!async function(){if(e)try{m(!0);let{data:s,error:r}=await i.O.from("professional_settings").select("*").eq("professional_id",e.id).single();if(r&&"PGRST116"!==r.code)throw r;if(s)c(s);else{let{data:s,error:r}=await i.O.from("professional_settings").insert([{professional_id:e.id,auto_reply_enabled:!0,voice_enabled:!0,reminder_enabled:!0,reminder_hours_before:24,welcome_message:"Bonjour et merci de me contacter! Comment puis-je vous aider aujourd'hui?",language:"fr"}]).select().single();if(r)throw r;c(s)}}catch(e){console.error("Error fetching settings:",e),l.Am.error("Erreur lors du chargement des param\xe8tres")}finally{m(!1)}}()},[e]);let y=async()=>{if(e&&r)try{x(!0);let{error:s}=await i.O.from("professional_settings").update({auto_reply_enabled:r.auto_reply_enabled,voice_enabled:r.voice_enabled,reminder_enabled:r.reminder_enabled,reminder_hours_before:r.reminder_hours_before,welcome_message:r.welcome_message,language:r.language}).eq("professional_id",e.id);if(s)throw s;l.Am.success("Param\xe8tres enregistr\xe9s")}catch(e){console.error("Error saving settings:",e),l.Am.error("Erreur lors de l'enregistrement des param\xe8tres")}finally{x(!1)}},_=async()=>{if(e&&g&&b)try{j(!0);let s=await fetch("/api/test/whatsapp",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":e.id},body:JSON.stringify({to:g,message:b})});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to send test message")}l.Am.success("Message de test envoy\xe9")}catch(e){console.error("Error sending test message:",e),l.Am.error("Erreur lors de l'envoi du message de test")}finally{j(!1)}};return s||u?(0,n.jsx)(o.Z,{children:(0,n.jsx)("div",{className:"p-8 text-center",children:"Chargement..."})}):e?r?(0,n.jsx)(o.Z,{children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Param\xe8tres"}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,n.jsxs)(d.O.Group,{children:[(0,n.jsxs)(d.O.List,{className:"flex border-b",children:[(0,n.jsx)(d.O,{className:e=>{let{selected:s}=e;return"\n                px-4 py-2 text-sm font-medium\n                ".concat(s?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700","\n              ")},children:"G\xe9n\xe9ral"}),(0,n.jsx)(d.O,{className:e=>{let{selected:s}=e;return"\n                px-4 py-2 text-sm font-medium\n                ".concat(s?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700","\n              ")},children:"WhatsApp"}),(0,n.jsx)(d.O,{className:e=>{let{selected:s}=e;return"\n                px-4 py-2 text-sm font-medium\n                ".concat(s?"border-b-2 border-indigo-500 text-indigo-600":"text-gray-500 hover:text-gray-700","\n              ")},children:"Notifications"})]}),(0,n.jsxs)(d.O.Panels,{className:"p-6",children:[(0,n.jsx)(d.O.Panel,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Langue"}),(0,n.jsxs)("select",{value:r.language,onChange:e=>c({...r,language:e.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[(0,n.jsx)("option",{value:"fr",children:"Fran\xe7ais"}),(0,n.jsx)("option",{value:"en",children:"Anglais"})]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"auto_reply_enabled",checked:r.auto_reply_enabled,onChange:e=>c({...r,auto_reply_enabled:e.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,n.jsx)("label",{htmlFor:"auto_reply_enabled",className:"ml-2 block text-sm text-gray-700",children:"Activer les r\xe9ponses automatiques"})]})]})}),(0,n.jsx)(d.O.Panel,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Message de bienvenue"}),(0,n.jsx)("textarea",{value:r.welcome_message,onChange:e=>c({...r,welcome_message:e.target.value}),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"voice_enabled",checked:r.voice_enabled,onChange:e=>c({...r,voice_enabled:e.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,n.jsx)("label",{htmlFor:"voice_enabled",className:"ml-2 block text-sm text-gray-700",children:"Activer la transcription des messages vocaux"})]}),(0,n.jsxs)("div",{className:"border-t pt-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Tester WhatsApp"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Num\xe9ro de t\xe9l\xe9phone"}),(0,n.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"+33612345678",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Message"}),(0,n.jsx)("textarea",{value:b,onChange:e=>p(e.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,n.jsx)("button",{onClick:_,disabled:v||!g||!b,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:v?"Envoi...":"Envoyer un message de test"})]})]})]})}),(0,n.jsx)(d.O.Panel,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{type:"checkbox",id:"reminder_enabled",checked:r.reminder_enabled,onChange:e=>c({...r,reminder_enabled:e.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,n.jsx)("label",{htmlFor:"reminder_enabled",className:"ml-2 block text-sm text-gray-700",children:"Activer les rappels de rendez-vous"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Envoyer le rappel combien d'heures avant le rendez-vous"}),(0,n.jsxs)("select",{value:r.reminder_hours_before,onChange:e=>c({...r,reminder_hours_before:parseInt(e.target.value)}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[(0,n.jsx)("option",{value:"1",children:"1 heure"}),(0,n.jsx)("option",{value:"2",children:"2 heures"}),(0,n.jsx)("option",{value:"3",children:"3 heures"}),(0,n.jsx)("option",{value:"6",children:"6 heures"}),(0,n.jsx)("option",{value:"12",children:"12 heures"}),(0,n.jsx)("option",{value:"24",children:"24 heures"}),(0,n.jsx)("option",{value:"48",children:"48 heures"})]})]})]})})]})]}),(0,n.jsx)("div",{className:"px-6 py-4 border-t flex justify-end",children:(0,n.jsx)("button",{onClick:y,disabled:h,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:h?"Enregistrement...":"Enregistrer les param\xe8tres"})})]})]})}):(0,n.jsx)(o.Z,{children:(0,n.jsx)("div",{className:"p-8 text-center",children:"Erreur lors du chargement des param\xe8tres"})}):(0,n.jsx)(o.Z,{children:(0,n.jsx)("div",{className:"p-8 text-center",children:"Veuillez vous connecter pour acc\xe9der \xe0 cette page."})})}}},function(e){e.O(0,[118,774,888,179],function(){return e(e.s=3819)}),_N_E=e.O()}]);