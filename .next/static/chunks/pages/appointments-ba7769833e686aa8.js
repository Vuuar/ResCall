(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[167],{2447:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/appointments",function(){return s(4251)}])},5921:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var i=s(1527),n=s(959),r=s(4980),o=s(2852),a=s(8563);function l(e){let{professionalId:t,appointmentId:s,onSuccess:l}=e,[d,c]=(0,n.useState)([]),[u,m]=(0,n.useState)([]),[f,x]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!0),{register:g,handleSubmit:v,setValue:j,watch:b,formState:{errors:w}}=(0,r.cI)(),_=b("service_id"),N=d.find(e=>e.id===_);(0,n.useEffect)(()=>{!async function(){try{p(!0);let{data:e,error:i}=await o.O.from("services").select("*").eq("professional_id",t);if(i)throw i;c(e);let{data:n,error:r}=await o.O.from("clients").select("*").eq("professional_id",t);if(r)throw r;if(m(n),s){let{data:e,error:t}=await o.O.from("appointments").select("*").eq("id",s).single();if(t)throw t;j("client_id",e.client_id),j("service_id",e.service_id),j("date",new Date(e.start_time).toISOString().split("T")[0]),j("time",new Date(e.start_time).toISOString().split("T")[1].substring(0,5)),j("status",e.status),j("notes",e.notes)}}catch(e){console.error("Error fetching data:",e),a.Am.error("Erreur lors du chargement des donn\xe9es")}finally{p(!1)}}()},[t,s,j]);let y=async e=>{try{let i;x(!0);let n=new Date("".concat(e.date,"T").concat(e.time)),r=new Date(n);r.setMinutes(r.getMinutes()+((null==N?void 0:N.duration)||60));let d={professional_id:t,client_id:e.client_id,service_id:e.service_id,start_time:n.toISOString(),end_time:r.toISOString(),status:e.status,notes:e.notes};if((i=s?await o.O.from("appointments").update(d).eq("id",s):await o.O.from("appointments").insert([d])).error)throw i.error;a.Am.success(s?"Rendez-vous mis \xe0 jour":"Rendez-vous cr\xe9\xe9"),l&&l()}catch(e){console.error("Error saving appointment:",e),a.Am.error("Erreur lors de l'enregistrement du rendez-vous")}finally{x(!1)}};return h?(0,i.jsx)("div",{className:"p-4",children:"Chargement..."}):(0,i.jsxs)("form",{onSubmit:v(y),className:"space-y-6 p-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Client"}),(0,i.jsxs)("select",{...g("client_id",{required:"Client requis"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[(0,i.jsx)("option",{value:"",children:"S\xe9lectionner un client"}),u.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]}),w.client_id&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.client_id.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Service"}),(0,i.jsxs)("select",{...g("service_id",{required:"Service requis"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[(0,i.jsx)("option",{value:"",children:"S\xe9lectionner un service"}),d.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.name," - ",e.duration," min - ",(e.price/100).toFixed(2),"â‚¬"]},e.id))]}),w.service_id&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.service_id.message})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date"}),(0,i.jsx)("input",{type:"date",...g("date",{required:"Date requise"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),w.date&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.date.message})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Heure"}),(0,i.jsx)("input",{type:"time",...g("time",{required:"Heure requise"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"}),w.time&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:w.time.message})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Statut"}),(0,i.jsxs)("select",{...g("status"),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[(0,i.jsx)("option",{value:"scheduled",children:"Planifi\xe9"}),(0,i.jsx)("option",{value:"confirmed",children:"Confirm\xe9"}),(0,i.jsx)("option",{value:"cancelled",children:"Annul\xe9"}),(0,i.jsx)("option",{value:"completed",children:"Termin\xe9"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Notes"}),(0,i.jsx)("textarea",{...g("notes"),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{type:"submit",disabled:f,className:"inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:f?"Enregistrement...":s?"Mettre \xe0 jour":"Cr\xe9er"})})]})}},2607:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var i=s(1527);s(959);var n=s(8391),r=s.n(n);function o(e){let{children:t,title:s="WhatsApp Booking"}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r(),{children:[(0,i.jsx)("title",{children:s}),(0,i.jsx)("meta",{name:"description",content:"WhatsApp Booking Platform"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsx)("div",{className:"min-h-screen flex flex-col",children:t})]})}},9230:function(e,t,s){"use strict";s.d(t,{a:function(){return r}});var i=s(959),n=s(2852);function r(){let[e,t]=(0,i.useState)(null),[s,r]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async function(){try{r(!0);let{data:{session:e}}=await n.O.auth.getSession();if(null==e?void 0:e.user){let{data:s,error:i}=await n.O.from("professionals").select("*").eq("id",e.user.id).single();i?(console.error("Error fetching professional:",i),t(null)):t(s)}else t(null)}catch(e){console.error("Error getting user:",e),t(null)}finally{r(!1)}})();let{data:e}=n.O.auth.onAuthStateChange(async(e,s)=>{if("SIGNED_IN"===e&&(null==s?void 0:s.user)){let{data:e,error:i}=await n.O.from("professionals").select("*").eq("id",s.user.id).single();i?(console.error("Error fetching professional:",i),t(null)):t(e)}else"SIGNED_OUT"===e&&t(null)});return()=>{e.subscription.unsubscribe()}},[]),{user:e,loading:s}}},4251:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var i=s(1527),n=s(959),r=s(9230),o=s(2607),a=s(5522),l=s(1333),d=s.n(l);s(8769),s(642);var c=s(2852),u=s(8896);d().locale("fr");let m=(0,a.Zt)(d());function f(e){let{professionalId:t}=e,[s,r]=(0,n.useState)([]),[o,l]=(0,n.useState)(!0),[d,f]=(0,n.useState)(null),x=(0,u.useRouter)();function h(e){switch(e){case"confirmed":return"#4CAF50";case"scheduled":return"#2196F3";case"cancelled":return"#F44336";case"completed":return"#9E9E9E";default:return"#FF9800"}}return((0,n.useEffect)(()=>{async function e(){try{l(!0);let{data:e,error:s}=await c.O.from("appointments").select("\n            id,\n            start_time,\n            end_time,\n            status,\n            client_name,\n            service_type,\n            services (name, color)\n          ").eq("professional_id",t);if(s)throw s;let i=e.map(e=>{var t,s,i,n,r,o;return{id:e.id,title:"".concat(e.client_name," - ").concat((null===(t=e.services)||void 0===t?void 0:null===(s=t[0])||void 0===s?void 0:s.name)||e.service_type),start:new Date(e.start_time),end:new Date(e.end_time),status:e.status,client_name:e.client_name,service_name:(null===(i=e.services)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.name)||e.service_type,color:(null===(r=e.services)||void 0===r?void 0:null===(o=r[0])||void 0===o?void 0:o.color)||h(e.status)}});r(i)}catch(e){console.error("Error fetching appointments:",e),f("Failed to load appointments")}finally{l(!1)}}t&&e()},[t]),o)?(0,i.jsx)("div",{className:"flex justify-center p-8",children:"Chargement des rendez-vous..."}):d?(0,i.jsx)("div",{className:"text-red-500 p-8",children:d}):(0,i.jsx)("div",{className:"h-[600px] p-4",children:(0,i.jsx)(a.f,{localizer:m,events:s,startAccessor:"start",endAccessor:"end",style:{height:"100%"},views:["month","week","day","agenda"],defaultView:"week",onSelectEvent:e=>{x.push("/appointments/".concat(e.id))},eventPropGetter:e=>{let t={backgroundColor:e.color||h(e.status),borderRadius:"5px",opacity:.8,color:"white",border:"0px",display:"block"};return{style:t}},messages:{next:"Suivant",previous:"Pr\xe9c\xe9dent",today:"Aujourd'hui",month:"Mois",week:"Semaine",day:"Jour",agenda:"Agenda"}})})}var x=s(5921),h=s(5669);function p(){let{user:e,loading:t}=(0,r.a)(),[s,a]=(0,n.useState)(!1);return t?(0,i.jsx)(o.Z,{children:(0,i.jsx)("div",{className:"p-8 text-center",children:"Chargement..."})}):e?(0,i.jsx)(o.Z,{children:(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"Rendez-vous"}),(0,i.jsx)("button",{onClick:()=>a(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Nouveau rendez-vous"})]}),(0,i.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,i.jsx)(f,{professionalId:e.id})}),(0,i.jsxs)(h.V,{open:s,onClose:()=>a(!1),className:"relative z-50",children:[(0,i.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,i.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,i.jsxs)(h.V.Panel,{className:"mx-auto max-w-md rounded bg-white p-6 shadow-xl",children:[(0,i.jsx)(h.V.Title,{className:"text-lg font-medium mb-4",children:"Nouveau rendez-vous"}),(0,i.jsx)(x.Z,{professionalId:e.id,onSuccess:()=>a(!1)}),(0,i.jsx)("button",{onClick:()=>a(!1),className:"mt-4 text-sm text-gray-500 hover:text-gray-700",children:"Annuler"})]})})]})]})}):(0,i.jsx)(o.Z,{children:(0,i.jsx)("div",{className:"p-8 text-center",children:"Veuillez vous connecter pour acc\xe9der \xe0 cette page."})})}}},function(e){e.O(0,[784,883,989,980,65,774,888,179],function(){return e(e.s=2447)}),_N_E=e.O()}]);